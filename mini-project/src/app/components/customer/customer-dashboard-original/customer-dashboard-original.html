<!-- BLOCK ONLY UNTIL CUSTOMER EXISTS -->
@if (!customer) {
<div class="text-center text-gray-500 p-6">
  Fetching dashboard...
</div>
}

@if (customer) {
<div class="min-h-screen bg-slate-50 text-slate-900">

  <div class="max-w-7xl mx-auto px-6 pt-10 space-y-8">

    <div class="relative bg-white rounded-3xl shadow-xl p-8 overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-br from-indigo-50 via-white to-emerald-50"></div>

      <div class="relative">
        <h2 class="text-3xl font-extrabold tracking-tight">
          {{ user?.firstName }} {{ user?.lastName }}
        </h2>
        <p class="text-slate-500 mt-1">
          Welcome back to your insurance dashboard
        </p>
      </div>
    </div>


    <!-- ANALYTICS CARDS -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">

      <!-- Total Policies -->
      <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
        <p class="text-sm font-semibold text-slate-500 uppercase tracking-wide">Total Policies</p>
        <p class="text-3xl font-bold mt-2 text-slate-900">{{ policies?.length ?? 0 }}</p>
        <p class="text-xs text-slate-400 mt-1">
          <span class="text-emerald-600 font-medium">{{ activePoliciesCount }} Active</span>
        </p>
      </div>

      <!-- Claims -->
      <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
        <p class="text-sm font-semibold text-slate-500 uppercase tracking-wide">Claims Raised</p>
        <p class="text-3xl font-bold mt-2 text-slate-900">{{ claims?.length ?? 0 }}</p>
        <p class="text-xs text-slate-400 mt-1">Requests</p>
      </div>

      <!-- Total Paid -->
      <div
        class="bg-gradient-to-br from-indigo-500 to-indigo-700 rounded-2xl p-6 shadow-lg shadow-indigo-200 text-white">
        <p class="text-sm font-medium text-indigo-100 uppercase tracking-wide opacity-80">Total Paid</p>
        <p class="text-3xl font-bold mt-2">₹ {{ totalPremiumPaid | number }}</p>
        <p class="text-xs text-indigo-200 mt-1">Lifetime Premium</p>
      </div>

      <!-- Pending Dues -->
      <div class="bg-white rounded-2xl p-6 shadow-sm border border-red-100">
        <p class="text-sm font-semibold text-red-500 uppercase tracking-wide">Pending Dues</p>
        <p class="text-3xl font-bold mt-2 text-slate-800">₹ {{ totalPendingDue | number }}</p>
        <p class="text-xs text-red-400 mt-1 font-medium">Due Immediately</p>
      </div>

    </div>

    <!-- CHARTS SECTION -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">

      <!-- Monthly Expenses -->
      <div class="bg-white p-6 rounded-3xl shadow-lg border border-slate-50">
        <h3 class="text-lg font-bold text-slate-800 mb-6">Monthly Premium Expenses</h3>
        <div class="h-64">
          <canvas baseChart [data]="expenseChartData" [options]="expenseChartOptions" type="bar"></canvas>
        </div>
      </div>

      <!-- Claims Analysis -->
      <div class="bg-white p-6 rounded-3xl shadow-lg border border-slate-50">
        <h3 class="text-lg font-bold text-slate-800 mb-6">Claims Status</h3>
        <div class="h-64 flex justify-center">
          <canvas baseChart [data]="claimChartData" [options]="claimChartOptions" type="doughnut"></canvas>
        </div>
      </div>
    </div>


    <!-- POLICY LIST (NAMES ONLY) -->
    <div class="bg-white rounded-3xl shadow-xl p-8">
      <h3 class="text-xl font-bold mb-6">My Policies</h3>

      <ul class="space-y-4">
        @for (policy of policies; track policy.id) {
        <li
          class="flex justify-between items-center p-4 rounded-xl border border-slate-100 hover:bg-slate-50 transition">

          <div>
            <p class="font-semibold text-slate-900">{{ policy.name }}</p>
            <p class="text-xs text-slate-500 capitalize">{{ policy.type }}</p>
          </div>

          <span class="px-4 py-1 rounded-full text-xs font-semibold" [class.bg-emerald-100]="policy.status === 'active'"
            [class.text-emerald-700]="policy.status === 'active'" [class.bg-red-100]="policy.status === 'inactive'"
            [class.text-red-700]="policy.status === 'inactive'">
            {{ policy.status }}
          </span>

        </li>
        }
      </ul>
    </div>

    <!-- CLAIMS LIST -->
    <div class="bg-white rounded-3xl shadow-xl p-8">
      <h3 class="text-xl font-bold mb-6">My Claims</h3>

      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="text-left text-slate-500 border-b">
              <th class="pb-3">#</th>
              <th class="pb-3">Policy</th>
              <th class="pb-3">Amount</th>
              <th class="pb-3">Status</th>
            </tr>
          </thead>

          <tbody>
            @for (claim of claims; let i = $index; track claim.id) {
            <tr class="border-b last:border-none hover:bg-slate-50 transition">
              <td class="py-4">{{ i + 1 }}</td>

              <td class="py-4 font-medium">
                {{ policyNameMap[claim.policyId] }}
              </td>

              <td class="py-4 font-semibold">
                ₹{{ claim.amountRequested }}
              </td>

              <td class="py-4">
                <span class="px-3 py-1 rounded-full text-xs font-semibold"
                  [class.bg-yellow-100]="claim.status === 'pending'"
                  [class.text-yellow-700]="claim.status === 'pending'"
                  [class.bg-emerald-100]="claim.status === 'approved'"
                  [class.text-emerald-700]="claim.status === 'approved'"
                  [class.bg-red-100]="claim.status === 'rejected'" [class.text-red-700]="claim.status === 'rejected'">
                  {{ claim.status }}
                </span>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>



  </div>
</div>
}